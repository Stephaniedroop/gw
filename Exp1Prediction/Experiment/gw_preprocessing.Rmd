---
title: "gw_preprocessing"
output: html_document
date: "2025-06-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## History
The start of this doc came from the old `pizzaland_parameters.R` script.

```{r}
rm(list = ls())
library(stringi)
library(data.table)
library(tidyverse)

# Read in data downloaded as long from testable
pizpar <- read.csv("params_data_Jan23.csv") # 1456 obs of 41 vars
```

```{r}
# Choose only active rows
pizpar <-  pizpar %>% filter(mindsCode!="") # 1440 obs of 41 vars = 90 ppts

# Reverse response columns for group 2
pizpar <- pizpar %>% 
  mutate(flipped = if_else(subjectGroup=='2', stri_reverse(responseCode), responseCode))

# Copy just in case
pizpar$flipped2 <- pizpar$flipped

# Split out the response column and remove delimiter |
# These names are needed due to the different starting points of the agents, different food was visible
# Later we can know which relates to which by eg. `if_else Start=='hotdog"`
pizpar <- separate(data = pizpar, col = flipped2, into = c("short_inv", "long_inv", "short_vis", "long_vis"), sep = "\\|")
```



```{r}
# The convention of eg. 'short path to visible food' was used for this part of the project, self contained. Was then abandoned.
pizpar$short_vis <- as.numeric(pizpar$short_vis) 
pizpar$long_vis <- as.numeric(pizpar$long_vis)
pizpar$short_inv <- as.numeric(pizpar$short_inv)
pizpar$long_inv <- as.numeric(pizpar$long_inv)


# New smaller df with columns we need
df <- pizpar %>% select(mindsCode, subjectGroup, stim1, rowNo, note1, short_vis, long_vis, short_inv, long_inv)
```


This is a new (9 June 2025) addition to remove the 0s - I reran with this and then redid the next script (`find_modelSD.Rmd`). If in fact we want the 0s, run this whole script again without this following chunk:

```{r}
# There are some 0s by mistake. I surmise they meant 1. 1 was the minimum allowable answer. So I replace
#pizpar2 <- replace(pizpar2, pizpar2 == 0, 1)
```

Actually Tadeg says to remove the whole rows with the 0s, which would be 1.3% of the data, an acceptable loss rate

```{r}
df[df == 0] <- NA
df <- na.omit(df) # 1421 rows - we lost 19
```


```{r}
# Set columns for what the condition tags actually mean
df <- df %>% mutate(Preference = if_else(grepl("F", note1), 'Hot dogs', 'Absent'))
df <- df %>% mutate(Knowledge = if_else(grepl("K", note1), 'Knows area', 'Does not know area'))
df <- df %>% mutate(Character = if_else(grepl("L", note1), 'Lazy', 'Sporty'))
df <- df %>% mutate(Start = if_else(grepl("A", stim1), 'Hot dogs visible', 'Pizza visible'))

# Set as factors for the regressions
df$Preference <- factor(df$Preference, levels = c('Absent', 'Hot dogs'),labels = c('Absent', 'Hot dogs'))
df$Knowledge <- factor(df$Knowledge, levels = c('Does not know area', 'Knows area'), labels = c('No', 'Yes'))
df$Character <- factor(df$Character, levels = c('Lazy', 'Sporty'), labels = c('Lazy', 'Sporty'))
df$Start <- factor(df$Start, levels = c('Pizza visible', 'Hot dogs visible'), labels = c('Pizza visible', 'Hot dogs visible'))

```




```{r}
# Recode things and make the order of everything as consistent as possible
df <- df %>% 
  mutate( lik_short_pizza = if_else(Start=="Hot dogs visible", 
                                    short_inv, short_vis),
          lik_long_pizza = if_else(Start=="Hot dogs visible", 
                                   long_inv, long_vis),
          lik_short_hotdog = if_else(Start=="Hot dogs visible", 
                                     short_vis, short_inv),
          lik_long_hotdog = if_else(Start=="Hot dogs visible", 
                                    long_vis, long_inv)) %>%
  select(-short_vis, -long_vis, -short_inv, -long_inv)

df<-df %>% mutate(lik_sum = lik_short_pizza + lik_long_pizza + lik_short_hotdog + lik_long_hotdog,
                      p_short_pizza = lik_short_pizza/lik_sum,
                      p_long_pizza = lik_long_pizza/lik_sum,
                      p_short_hotdog = lik_short_hotdog/lik_sum,
                      p_long_hotdog = lik_long_hotdog/lik_sum,
                      p_long = p_long_pizza + p_long_hotdog,
                      p_hotdog = p_short_hotdog + p_long_hotdog)


df<-df %>% mutate(Preference = factor(Preference, levels = c('Absent','Hot dogs'), labels = c('Absent','Hotdog')),
                                           Knowledge = factor(Knowledge, levels = c('No','Yes')),
                                           Character = factor(Character, levels = c('Lazy','Sporty')),
                                           Start = factor(Start, levels = c('Pizza visible','Hot dogs visible'), labels = c('See_pizza','See_hotdog')),
                                           P = factor(Preference, levels = c('Absent','Hotdog'), labels = 0:1),
                                           K = factor(Knowledge, levels = c('No','Yes'), labels = 0:1),
                                           C = factor(Character, levels = c('Lazy','Sporty'), labels = 0:1),
                                           S = factor(Start, levels = c('See_pizza','See_hotdog'), labels = 0:1), 
                                           SituationVerbose = paste0(Preference, Knowledge,Character, Start),
                                           Situation = paste0(P,K,C,S),
                                           mindsCode = factor(mindsCode, levels = unique(mindsCode)),
                                           id = factor(mindsCode, levels = unique(mindsCode), labels = 1:length(unique(mindsCode)))) %>% arrange(id, S,C,K,P)


df<-df %>% mutate(SituationVerbose = factor(SituationVerbose, levels = SituationVerbose[1:16]),
                  Situation = factor(Situation, levels = Situation[1:16]))

#Put the outcome order in the intutive sequence, shortpath-pizza, longpath-pizza, shortpath-hotdog, longpath-hotdog

```

This is the end of preprocessing. Think best to save as csv and start a new script for model

```{r}
write.csv(df, '../Data/gwdata.csv')
```